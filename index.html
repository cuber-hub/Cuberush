<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TwistyTimer | Professional Rubik's cube Timer/Solve tracker</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#1F1F1F">
  <link rel="shortcut icon" href="r.svg" type="image/x-icon">
  <meta name="description"
    content="Use TwistyTime, a fast and free Rubik’s Cube timer app for speedcubers. Track solve history, calculate averages like Ao5 and Ao12, and improve your speedcubing.">
  <meta name="keywords"
    content="cube timer,online cube timer,Rubik’s cube timer,speedcube timer,3x3 cube timer,cstimer alternative,twisty cube timer,cubing timer online,free Rubik's cube timer,best cube timertimer, cstimer, rubiks cube timer, online timer, web timer ,twistytime ,twistytimer">

  <style>
    :root {
      --primary-color: #121212;
      --bg-color: #ffffff;
      --text-color: #333;
      --accent: #f0f0f0;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      overflow-x: hidden;
    }

    body.dark-theme {
      --bg-color: #121212;
      --text-color: #eee;
      --accent: #1f1f1f;
      --primary-color: #121212;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      background-color: var(--primary-color);
      color: #ffffff;
      padding: 1rem;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      position: relative;
      z-index: 100;
    }

    .logo {
      width: 32px;
      height: 32px;
      fill: currentColor;
    }

    .scramble-container {
      background-color: var(--accent);
      padding: 1rem;
      text-align: center;
      border-bottom: 1px solid #ddd;
      position: relative;
      z-index: 100;
      display: flex;
      align-items: flex-start;
      gap: 1rem;
    }

    .scramble-text {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      word-spacing: 0.3rem;
      line-height: 1.4;
      flex: 1;
    }

    .scramble-controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .scramble-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .scramble-btn:hover {
      opacity: 0.9;
    }

    .content-container {
      display: flex;
      flex: 1;
      position: relative;
      min-height: calc(100vh - 200px);
    }

    .sidebar {
      width: 300px;
      background-color: var(--accent);
      padding: 1rem;
      overflow-y: auto;
      position: relative;
      z-index: 50;
      flex-shrink: 0;
    }

    .main-content {
      flex: 1;
      position: relative;
      min-height: 100%;
    }

    .timer-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      cursor: pointer;
      user-select: none;
      padding: 2rem;
      border-radius: 10px;
      transition: background-color 0.2s;
      z-index: 10;
      min-width: 300px;
      height: 220px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .timer-container:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }

    .timer-container.preparing {
      background-color: rgba(0, 255, 0, 0.1);
    }

    .timer-container.timing {
      background-color: rgba(255, 165, 0, 0.1);
    }

    #timer {
      font-size: 8rem;
      margin: 1rem 0;
      font-weight: bold;
      width: 8.5ch;
      display: inline-block;
      text-align: center;
    }

    .help-text {
      font-size: 1rem;
      color: gray;
    }

    .timer-state {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    h2,
    h3 {
      margin-top: 1.5rem;
    }
  

    .theme-options {
      display: none !important;
    }

    .theme-option {
      display: none !important;
    }

    .theme-option.active {
      display: none !important;
    }

    .theme-blue,
    .theme-green,
    .theme-red,
    .theme-purple {
      display: none !important;
    }

    .custom-color-container {
      display: none !important;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
      margin-right: 10px;
    }

    .switch input {
      display: none;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      background-color: #ccc;
      transition: 0.4s;
      border-radius: 20px;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }

    .slider:before {
      content: "";
      position: absolute;
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: 0.4s;
      border-radius: 50%;
    }

    .switch input:checked+.slider {
      background-color: #121212;
    }

    .switch input:checked+.slider:before {
      transform: translateX(20px);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 1rem;
    }

    .stat-item {
      background: var(--bg-color);
      padding: 0.5rem;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .history-list {
      margin-top: 1rem;
      max-height: 200px;
      overflow-y: auto;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.3rem 0;
      border-bottom: 1px solid #ddd;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    .solve-number {
      font-weight: bold;
      min-width: 25px;
      color: var(--text-color);
    }

    .solve-time {
      flex: 1;
      text-align: center;
    }

    .solve-date {
      font-size: 0.8rem;
      color: #666;
      min-width: 60px;
    }

    .delete-btn {
      background: transparent;
      border: none;
      color: red;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      min-width: 20px;
    }

    .dark-theme .history-item {
      border-color: #444;
    }

    .dark-theme .scramble-container {
      border-color: #444;
    }

    .dark-theme .solve-date {
      color: #aaa;
    }

    .solve-menu-btn {
      background: transparent;
      border: none;
      color: var(--text-color);
      cursor: pointer;
      padding: 0 5px;
      font-size: 1.2rem;
      opacity: 0.7;
    }

    .solve-menu-btn:hover {
      opacity: 1;
    }

    .solve-menu {
      position: absolute;
      background: var(--bg-color);
      border: 1px solid #ccc;
      border-radius: 4px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      padding: 0.5rem 0;
      min-width: 120px;
      z-index: 1000;
      display: none;
    }

    .dark-theme .solve-menu {
      border-color: #444;
    }

    .solve-menu-item {
      padding: 0.5rem 1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .solve-menu-item:hover {
      background: var(--accent);
    }

    .solve-comment {
      font-size: 0.8rem;
      color: #666;
      font-style: italic;
      margin-top: 0.2rem;
    }

    .dark-theme .solve-comment {
      color: #aaa;
    }

    .dnf {
      text-decoration: line-through;
      opacity: 0.7;
    }

    .plus2::after {
      content: '+2';
      color: #dc3545;
      font-size: 0.8em;
      margin-left: 2px;
    }

    .settings-section {
      margin-bottom: 1rem;
    }

    .checkbox-option {
      display: flex;
      align-items: center;
      margin-top: 0.5rem;
      flex-wrap: wrap;
    }

    .checkbox-option input[type="checkbox"] {
      margin-right: 0.5rem;
    }

    .history-controls {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    .clear-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .clear-btn:hover {
      opacity: 0.9;
    }

    .export-btn {
      background-color: #121212;
      color: white;
      border: none;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    .export-btn:hover {
      opacity: 0.8;
    }

    .confirmation-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background-color: var(--bg-color);
      padding: 2rem;
      border-radius: 8px;
      text-align: center;
      max-width: 400px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin: 1rem;
    }

    .modal-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .modal-btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .confirm-btn {
      background-color: #dc3545;
      color: white;
    }

    .cancel-btn {
      background-color: #6c757d;
      color: white;
    }

    .event-box {
      min-width: 120px;
      background: #fff;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      gap: 0.5rem;
    }

    .event-box label {
      font-weight: bold;
      margin-bottom: 0.3rem;
      color: inherit;
    }

    .event-box select {
      padding: 0.3rem;
      border-radius: 4px;
      border: 1px solid #aaa;
      background: #fff;
      color: #333;
    }

    body.dark-theme .event-box {
      background: #121212;
      color: #fff;
      border-color: #444;
    }

    body.dark-theme .scramble-container {
      border-color: #444;
    }

    body.dark-theme .event-box select {
      background: #121212;
      color: #fff;
      border-color: #444;
    }

    /* Hide elements during timing */
    body.timing-active {
      background-color: var(--bg-color);
    }

    body.timing-active header,
    body.timing-active .scramble-container,
    body.timing-active .sidebar,
    body.timing-active .help-text,
    body.timing-active .timer-state {
      opacity: 0;
      transition: opacity 0.3s ease-out;
      pointer-events: none;
    }

    body.timing-active .timer-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      background: var(--bg-color);
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      margin: 0;
    }

    body.timing-active #timer {
      font-size: 12rem;
      margin: 0;
    }

    @media (max-width: 768px) {
      body.timing-active #timer {
        font-size: 8rem;
      }
    }

    @media (max-width: 480px) {
      body.timing-active #timer {
        font-size: 6rem;
      }
    }

    /* Mobile Responsive Styles */
    @media (max-width: 768px) {
      .content-container {
        flex-direction: column;
      }

      .sidebar {
        width: 100%;
        order: 2;
        max-height: 50vh;
        overflow-y: auto;
      }

      .main-content {
        order: 1;
        min-height: 50vh;
      }

      .timer-container {
        position: relative;
        top: auto;
        left: auto;
        transform: none;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 50vh;
        padding: 1rem;
        min-width: auto;
      }

      #timer {
        font-size: 4.5rem;
        margin: 0.5rem 0;
      }

      .help-text {
        font-size: 0.9rem;
        text-align: center;
      }

      .scramble-text {
        font-size: 1rem;
      }

      .scramble-controls {
        gap: 0.5rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .history-list {
        max-height: 150px;
      }

      header h1 {
        font-size: 1.5rem;
      }

      .logo {
        width: 24px;
        height: 24px;
      }
    }

    @media (max-width: 480px) {
      header {
        padding: 0.5rem;
      }

      .scramble-container {
        padding: 0.5rem;
      }

      .sidebar {
        padding: 0.5rem;
      }

      #timer {
        font-size: 3.5rem;
      }

      .timer-state {
        font-size: 1rem;
      }

      .help-text {
        font-size: 0.8rem;
      }

      .scramble-text {
        font-size: 0.9rem;
        word-spacing: 0.2rem;
      }

      .checkbox-option {
        font-size: 0.9rem;
      }

      .scramble-btn,
      .export-btn,
      .clear-btn {
        font-size: 0.8rem;
        padding: 0.4rem 0.6rem;

      }
    }

    #new-scramble {
      background-color: #dc3545;
    }

    /* Tablet Portrait */
    @media (min-width: 769px) and (max-width: 1024px) {
      .sidebar {
        width: 250px;
      }

      #timer {
        font-size: 6rem;
      }
    }

    /* Large Desktop */
    @media (min-width: 1400px) {
      .sidebar {
        width: 350px;
      }

      #timer {
        font-size: 6rem;
      }

      .timer-container {
        min-width: 400px;
      }
    }

    .sidebar {
      animation-name: sidebar;
      animation-duration: 0.7s;
      animation-timing-function: ease-in-out;
    }

    @keyframes sidebar {
      from {
        transform: translateX(-500px);
        opacity: 0;
      }

      to {
        transform: translateX(0px);
        opacity: 100;
      }

    }

    .scramble-container {
      animation-name: upper;
      animation-duration: 0.7s;
      animation-timing-function: ease-in-out;
    }

    @keyframes upper {
      from {
        transform: translateY(-200px);
      }

      to {
        transform: translateY(0px);
      }
    }

    header {
      animation-name: upper;
      animation-duration: 0.7s;
      animation-timing-function: ease-in-out;
    }

    .timer-container {
      animation-duration: 0.9s;
      animation-name: uppe;
      animation-timing-function: ease-in-out;
    }

    @keyframes uppe {
      from {
        opacity: 0;
      }

      to {
        opacity: 100;
      }
    }

    .option:hover {
      background-color: #dc3545;
      color: #fff;
    }

    .history-item.best-solve .solve-time {
      color: #28a745;
      font-weight: bold;
    }

    .history-item.worst-solve .solve-time {
      color: #dc3545;
      font-weight: bold;
    }

    .dark-theme .history-item.best-solve .solve-time {
      color: #00ff00;
    }

    .dark-theme .history-item.worst-solve .solve-time {
      color: #ff4444;
    }
    .rome{
      background-color: #C93341;
    }

    #screenshot-btn {
      background-color: #C93341 !important;
      color: white;
    }
    #screenshot-btn:hover {
      background-color: #b32a36 !important;
    }
  </style>
</head>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<body>
   <div id="screenshot-target">
  <div class="app-container">
    <header>
      <svg class="logo" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
        <path d="M6 8L12 4L26 10L20 14L6 8Z" fill="currentColor" opacity="0.9" />
        <path d="M6 8V22L12 26V12L6 8Z" fill="currentColor" opacity="0.7" />
        <path d="M12 26L26 22V10L20 14L12 26Z" fill="currentColor" opacity="0.5" />
      </svg>

      <h1>TwistyTimer</h1>

    </header>
    <div class="scramble-container" style="display: flex; align-items: flex-start; gap: 1rem;">
      <div style="flex: 1;">
        <div class="scramble-text" id="scramble-text">R U R' U' R' F R2 U' R' U' R U R' F'</div>
        <div class="scramble-controls">
          <button class="scramble-btn" id="new-scramble">New Scramble</button>
          <div class="checkbox-option">
            <input type="checkbox" id="auto-scramble" checked>
            <label for="auto-scramble">Auto-generate after solve</label>
          </div>
        </div>
      </div>
      <div class="event-box">
        <label for="cube-event">Event</label>
        <select id="cube-event">
          <option value="3x3" class="option">3x3</option>
          <option value="2x2" class="option">2x2</option>
          <option value="4x4" class="option">4x4</option>
          <option value="5x5" class="option">5x5</option>
          <option value="6x6" class="option">6x6</option>
          <option value="7x7" class="option">7x7</option>
          <option value="pyraminx" class="option">Pyraminx</option>
          <option value="megaminx" class="option">Megaminx</option>
          <option value="skewb" class="option">Skewb</option>
          <option value="square-1" class="option">Square-1</option>
          <option value="clock" class="option">Clock</option>

        </select>
      </div>
    </div>

    <div class="content-container">
      <div class="sidebar">
        <div class="settings-section">
          <h2>Settings</h2>
          <div class="dark-mode-toggle">
            <label class="switch">
              <input type="checkbox" id="darkModeToggle">
              <span class="slider"></span>
            </label>
            <span>Dark Mode</span>
          </div>
          <div class="inspection-toggle">
            <label class="switch">
              <input type="checkbox" id="wcaInspection">

            </label>

          </div>
        <div class="buttone">
          <button id="screenshot-btn" class="rome" style="color: white; padding: 0.4rem 0.8rem; border: 0; background-color: #C93341; border-radius: 5px;">📸 Screenshot</button>

        </div>
          <div class="theme-options">
            <div class="theme-option theme-blue" data-theme="#007bff"></div>
            <div class="theme-option theme-green" data-theme="#28a745"></div>
            <div class="theme-option theme-red" data-theme="#dc3545"></div>
            <div class="theme-option theme-purple" data-theme="#6f42c1"></div>
            <div class="custom-color-container">
              <input type="color" id="customColorPicker" title="Choose custom color" />
            </div>
          </div>
        </div>

        <div class="settings-section">
          <h2>Stats</h2>
          <div class="stats-grid">
            <div class="stat-item"><strong>Avg of 5</strong><br><span id="ao5">-</span></div>
            <div class="stat-item"><strong>Avg of 12</strong><br><span id="ao12">-</span></div>
            <div class="stat-item"><strong>Best</strong><br><span id="best-time">-</span></div>
            <div class="stat-item"><strong>Worst</strong><br><span id="worst-time">-</span></div>
          </div>
        </div>

        <div class="settings-section">
          <h2>History</h2>
          <div class="checkbox-option">
            <input type="checkbox" id="show-numbering" checked>
            <label for="show-numbering">Show solve numbers</label>
          </div>
          <div class="history-controls">
            <button class="clear-btn" id="clear-history">Clear All</button>
            <button class="export-btn" id="export-history">Export</button>
          </div>
          <div class="history-list" id="history-list"></div>
        </div>
      </div>

      <div class="main-content">
        <div class="timer-container" id="timer-container">
          <div class="timer-state">Ready</div>
          <div id="timer">0.000</div>
          <p class="help-text">Hold <strong>SPACE</strong> or <strong>CLICK</strong> to prepare, release to start.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="confirmation-modal" id="confirmation-modal">
    <div class="modal-content">
      <h3>Clear All History?</h3>
      <p>This action cannot be undone. All your solve times and statistics will be permanently deleted.</p>
      <div class="modal-buttons">
        <button class="modal-btn cancel-btn" id="cancel-clear">Cancel</button>
        <button class="modal-btn confirm-btn" id="confirm-clear">Clear All</button>
      </div>
    </div>
  </div>
  </div>
  <script>
    const Timer = {
      elements: {
        timer: null,
        timerState: null,
        timerContainer: null,
        historyList: null,
        scrambleText: null,
        eventSelect: null,
        sectionSelect: null,
        wcaInspection: null,
        showNumbering: null,
        autoScramble: null,
        darkMode: null
      },

      state: {
        interval: null,
        preparing: false,
        timing: false,
        history: [],
        solveCounter: 0,
        inspectionTime: 15,
        isInspecting: false,
        inspectionInterval: null,
        inspectionStartTime: 0
      },

      scramblers: {
        '2x2': () => {
          const moves = ['R', 'U', 'F', 'L', "R'", "U'", "F'", "L'", 'R2', 'U2', 'F2', 'L2'];
          let scramble = [];
          let lastMove = '';
          for (let i = 0; i < 9; i++) {
            let move;
            do {
              move = moves[Math.floor(Math.random() * moves.length)];
            } while (move[0] === lastMove[0]);
            lastMove = move;
            scramble.push(move);
          }
          return scramble.join(' ');
        },

        '3x3': () => {
          const moves = ['R', 'L', 'U', 'D', 'F', 'B', "R'", "L'", "U'", "D'", "F'", "B'", 'R2', 'L2', 'U2', 'D2', 'F2', 'B2'];
          let scramble = [];
          let lastFace = '';
          for (let i = 0; i < 20; i++) {
            let move;
            do {
              move = moves[Math.floor(Math.random() * moves.length)];
            } while (move[0] === lastFace);
            scramble.push(move);
            lastFace = move[0];
          }
          return scramble.join(' ');
        },

        '4x4': () => {
          const moves = ['R', 'L', 'U', 'D', 'F', 'B', "R'", "L'", "U'", "D'", "F'", "B'", 'R2', 'L2', 'U2', 'D2', 'F2', 'B2'];
          const wideMoves = ['Rw', 'Lw', 'Uw', 'Dw', 'Fw', 'Bw', "Rw'", "Lw'", "Uw'", "Dw'", "Fw'", "Bw'", 'Rw2', 'Lw2', 'Uw2', 'Dw2', 'Fw2', 'Bw2'];
          let scramble = [];
          let lastFace = '';

          // First part: regular moves
          for (let i = 0; i < 20; i++) {
            let move;
            do {
              move = moves[Math.floor(Math.random() * moves.length)];
            } while (move[0] === lastFace);
            scramble.push(move);
            lastFace = move[0];
          }

          // Second part: wide moves
          for (let i = 0; i < 20; i++) {
            let move = wideMoves[Math.floor(Math.random() * wideMoves.length)];
            scramble.push(move);
          }
          return scramble.join(' ');
        },

        '5x5': () => Timer.generateWithMoves([
          'R', 'L', 'U', 'D', 'F', 'B', "R'", "L'", "U'", "D'", "F'", "B'", 'R2', 'L2', 'U2', 'D2', 'F2', 'B2',
          'Rw', 'Lw', 'Uw', 'Dw', 'Fw', 'Bw', "Rw'", "Lw'", "Uw'", "Dw'", "Fw'", "Bw'", 'Rw2', 'Lw2', 'Uw2', 'Dw2', 'Fw2', 'Bw2',
          '3Rw', '3Lw', '3Uw', '3Dw', '3Fw', '3Bw', "3Rw'", "3Lw'", "3Uw'", "3Dw'", "3Fw'", "3Bw'", '3Rw2', '3Lw2', '3Uw2', '3Dw2', '3Fw2', '3Bw2'
        ], 60),

        '6x6': () => Timer.generateWithMoves([
          'R', 'L', 'U', 'D', 'F', 'B', "R'", "L'", "U'", "D'", "F'", "B'", 'R2', 'L2', 'U2', 'D2', 'F2', 'B2',
          'Rw', 'Lw', 'Uw', 'Dw', 'Fw', 'Bw', "Rw'", "Lw'", "Uw'", "Dw'", "Fw'", "Bw'", 'Rw2', 'Lw2', 'Uw2', 'Dw2', 'Fw2', 'Bw2',
          '3Rw', '3Lw', '3Uw', '3Dw', '3Fw', '3Bw', "3Rw'", "3Lw'", "3Uw'", "3Dw'", "3Fw'", "3Bw'", '3Rw2', '3Lw2', '3Uw2', '3Dw2', '3Fw2', '3Bw2'
        ], 80),

        '7x7': () => Timer.generateWithMoves([
          'R', 'L', 'U', 'D', 'F', 'B', "R'", "L'", "U'", "D'", "F'", "B'", 'R2', 'L2', 'U2', 'D2', 'F2', 'B2',
          'Rw', 'Lw', 'Uw', 'Dw', 'Fw', 'Bw', "Rw'", "Lw'", "Uw'", "Dw'", "Fw'", "Bw'", 'Rw2', 'Lw2', 'Uw2', 'Dw2', 'Fw2', 'Bw2',
          '3Rw', '3Lw', '3Uw', '3Dw', '3Fw', '3Bw', "3Rw'", "3Lw'", "3Uw'", "3Dw'", "3Fw'", "3Bw'", '3Rw2', '3Lw2', '3Uw2', '3Dw2', '3Fw2', '3Bw2',
          '3Dw', '3Bw', '3Lw', '3Rw', '3Fw', '3Uw'
        ], 100),

        'skewb': () => Timer.generateWithMoves(['R', 'L', 'U', 'B', "R'", "L'", "U'", "B'"], 9),

        'megaminx': () => {
          let scramble = [];
          for (let i = 0; i < 7; i++) {
            const moves = ['R++ D++', 'R++ D--', 'R-- D++', 'R-- D--'];
            for (let j = 0; j < 5; j++) {
              scramble.push(moves[Math.floor(Math.random() * moves.length)]);
            }
            scramble.push('U');
          }
          return scramble.join(' ');
        },

        'pyraminx': () => {
          const moves = ['L', 'R', 'U', 'B', "L'", "R'", "U'", "B'"];
          const tips = ['l', 'r', 'u', 'b', "l'", "r'", "u'", "b'"];
          let scramble = [];

          // Add tips (0-2 for each tip)
          for (let i = 0; i < 4; i++) {
            if (Math.random() < 0.75) {
              scramble.push(tips[Math.floor(Math.random() * tips.length)]);
            }
          }

          // Add regular moves
          for (let i = 0; i < 8; i++) {
            scramble.push(moves[Math.floor(Math.random() * moves.length)]);
          }
          return scramble.join(' ');
        },

        'square-1': () => {
          let scramble = [];
          for (let i = 0; i < 12; i++) {
            const top = Math.floor(Math.random() * 7) - 3;
            const bottom = Math.floor(Math.random() * 7) - 3;
            scramble.push(`(${top},${bottom})`);
            if (i < 11) scramble.push('/');
          }
          return scramble.join(' ');
        },

        'clock': () => {
          const moves = ['UR', 'DR', 'DL', 'UL', 'U', 'R', 'D', 'L', 'ALL'];
          let scramble = [];

          // First face
          for (let i = 0; i < 9; i++) {
            const move = moves[i];
            const amount = Math.floor(Math.random() * 12) - 5;
            scramble.push(`${move}${amount > 0 ? '+' : ''}${amount}`);
          }

          // Flip
          scramble.push('y2');

          // Second face
          for (let i = 0; i < 4; i++) {
            const move = moves[i];
            const amount = Math.floor(Math.random() * 12) - 5;
            scramble.push(`${move}${amount > 0 ? '+' : ''}${amount}`);
          }

          return scramble.join(' ');
        }
      },

      generateWithMoves(moves, length) {
        let scramble = [];
        let lastAxis = '';
        for (let i = 0; i < length; i++) {
          let move;
          do {
            move = moves[Math.floor(Math.random() * moves.length)];
            const currentAxis = move[0];
            if (currentAxis === lastAxis) continue;
            lastAxis = currentAxis;
            break;
          } while (true);
          scramble.push(move);
        }
        return scramble.join(' ');
      }, init() {
        this.initElements();
        this.setupEventListeners();
        this.loadSettings();
        this.updateScramble();
        this.setInitialTheme();
      },

      initElements() {
        this.elements = {
          timer: document.getElementById('timer'),
          timerState: document.querySelector('.timer-state'),
          timerContainer: document.getElementById('timer-container'),
          historyList: document.getElementById('history-list'),
          scrambleText: document.getElementById('scramble-text'),
          eventSelect: document.getElementById('cube-event'),

          wcaInspection: document.getElementById('wcaInspection'),
          showNumbering: document.getElementById('show-numbering'),
          autoScramble: document.getElementById('auto-scramble'),
          darkMode: document.getElementById('darkModeToggle')
        };
      },

      setupEventListeners() {
        document.addEventListener('keydown', (e) => {
          if (e.code === 'Space' && document.activeElement === document.body) {
            e.preventDefault();
            if (!this.state.timing) {
              this.startPreparing();
            }
          }
        });

        document.addEventListener('keyup', (e) => {
          if (e.code === 'Space' && document.activeElement === document.body) {
            e.preventDefault();
            this.stopOrStart();
          }
        });

        this.elements.timerContainer.addEventListener('mousedown', (e) => {
          e.preventDefault();
          if (!this.state.timing) {
            this.startPreparing();
          }
        });

        this.elements.timerContainer.addEventListener('mouseup', (e) => {
          e.preventDefault();
          this.stopOrStart();
        });

        this.elements.eventSelect.addEventListener('change', () => {
          this.updateScramble();
          this.saveSettings();
        });

        this.elements.darkMode.addEventListener('change', () => {
          document.body.classList.toggle('dark-theme', this.elements.darkMode.checked);
          this.saveSettings();
        });

        this.elements.wcaInspection.addEventListener('change', () => this.saveSettings());
        this.elements.showNumbering.addEventListener('change', () => {
          this.updateNumbering();
          this.saveSettings();
        });
        this.elements.autoScramble.addEventListener('change', () => this.saveSettings());

        // Clear history button
        document.getElementById('clear-history').addEventListener('click', () => {
          document.getElementById('confirmation-modal').style.display = 'flex';
        });

        document.getElementById('cancel-clear').addEventListener('click', () => {
          document.getElementById('confirmation-modal').style.display = 'none';
        });

        document.getElementById('confirm-clear').addEventListener('click', () => {
          this.state.history = [];
          this.state.solveCounter = 0;
          this.elements.historyList.innerHTML = '';
          this.updateStats();
          this.saveSettings();
          document.getElementById('confirmation-modal').style.display = 'none';
        });

        // Export history button
        document.getElementById('export-history').addEventListener('click', () => {
          const data = JSON.stringify(this.state.history.map(solve => ({
            time: solve.time,
            date: solve.date,
            event: solve.event
          })), null, 2);

          const blob = new Blob([data], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'twistytime-history.json';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });

        // New scramble button
        document.getElementById('new-scramble').addEventListener('click', () => {
          this.updateScramble();
        });
      },

      startPreparing() {
        if (!this.state.timing && !this.state.preparing && !this.state.isInspecting) {
          if (this.elements.wcaInspection.checked) {
            this.startInspection();
          } else {
            this.state.preparing = true;
            this.elements.timerState.textContent = 'Set';
            this.elements.timer.style.color = '#0f0';
            this.elements.timerContainer.classList.add('preparing');
          }
        }
      },

      startInspection() {
        this.state.isInspecting = true;
        this.state.inspectionStartTime = Date.now();
        this.elements.timer.style.color = '#ff0';
        this.elements.timer.textContent = '15';
        this.elements.timerState.textContent = 'Inspection';

        this.state.inspectionInterval = setInterval(() => {
          const elapsed = Math.floor((Date.now() - this.state.inspectionStartTime) / 1000);
          const remaining = 15 - elapsed;

          if (remaining >= 0) {
            this.elements.timer.textContent = remaining.toString();
            if (remaining <= 8) {
              this.elements.timer.style.color = '#f00';
            }
          } else if (remaining < -2) {
            clearInterval(this.state.inspectionInterval);
            this.elements.timer.textContent = 'DNF';
            this.state.isInspecting = false;
            setTimeout(() => {
              this.elements.timer.textContent = '0.000';
              this.elements.timer.style.color = '';
              this.elements.timerState.textContent = 'Ready';
            }, 2000);
          }
        }, 100);
      }, stopOrStart() {
        if (this.state.timing) {
          clearInterval(this.state.interval);
          const endTime = performance.now();
          const duration = ((endTime - this.state.startTime) / 1000).toFixed(3);
          this.state.solveCounter++;

          if (this.state.inspectionStartTime > 0) {
            const inspectionDuration = (this.state.startTime - this.state.inspectionStartTime) / 1000;
            if (inspectionDuration > 15 && inspectionDuration <= 17) {
              this.addToHistory((parseFloat(duration) + 2).toFixed(3));
            } else {
              this.addToHistory(duration);
            }
            this.state.inspectionStartTime = 0;
          } else {
            this.addToHistory(duration);
          }

          document.body.classList.remove('timing-active');
          this.elements.timerState.textContent = 'Ready';
          this.elements.timer.style.color = '';
          this.elements.timerContainer.classList.remove('timing');
          this.state.timing = false;

          if (this.elements.autoScramble.checked) {
            this.updateScramble();
          }
          this.saveSettings();
        } else if (this.state.preparing || this.state.isInspecting) {
          if (this.state.isInspecting) {
            clearInterval(this.state.inspectionInterval);
            this.state.isInspecting = false;
          }
          this.state.startTime = performance.now();
          this.elements.timerState.textContent = 'Timing...';
          this.elements.timer.style.color = '';
          this.elements.timerContainer.classList.remove('preparing');
          this.elements.timerContainer.classList.add('timing');
          document.body.classList.add('timing-active');
          this.state.interval = setInterval(() => {
            const time = ((performance.now() - this.state.startTime) / 1000).toFixed(3);
            this.elements.timer.textContent = time;
          }, 10);
          this.state.timing = true;
          this.state.preparing = false;
        }
      },

      updateScramble() {
        const currentEvent = this.elements.eventSelect.value;
        const scramble = this.generateScramble(currentEvent);
        this.elements.scrambleText.textContent = scramble;
      },

      generateScramble(event) {
        const scrambler = this.scramblers[event] || this.scramblers['3x3'];
        return scrambler();
      },

      addToHistory(time) {
        const solveData = {
          time: parseFloat(time),
          number: this.state.solveCounter,
          date: new Date(), event: this.elements.eventSelect.value
        };
        this.state.history.unshift(solveData);
        this.addHistoryItemToDOM(solveData);
        this.updateStats();
      }, addHistoryItemToDOM(solveData) {
        const item = document.createElement('div');
        item.className = 'history-item';

        const numberSpan = document.createElement('span');
        numberSpan.className = 'solve-number';
        numberSpan.textContent = `#${solveData.number}`;
        numberSpan.style.display = this.elements.showNumbering.checked ? 'block' : 'none';

        const timeSpan = document.createElement('span');
        timeSpan.className = 'solve-time';
        timeSpan.textContent = solveData.time.toFixed(3);
        if (solveData.isDNF) timeSpan.classList.add('dnf');
        if (solveData.isPlus2) timeSpan.classList.add('plus2');

        // Check if this is a best or worst time
        if (this.state.history.length > 0) {
          const times = this.state.history.map(solve => solve.time);
          const bestTime = Math.min(...times);
          const worstTime = Math.max(...times);
          if (solveData.time === bestTime) item.classList.add('best-solve');
          if (solveData.time === worstTime) item.classList.add('worst-solve');
        }

        const dateSpan = document.createElement('span');
        dateSpan.className = 'solve-date';
        dateSpan.textContent = `${solveData.event} ${solveData.date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;

        if (solveData.comment) {
          const commentDiv = document.createElement('div');
          commentDiv.className = 'solve-comment';
          commentDiv.textContent = solveData.comment;
          dateSpan.appendChild(commentDiv);
        }

        const menuBtn = document.createElement('button');
        menuBtn.className = 'solve-menu-btn';
        menuBtn.textContent = '⋮';
        menuBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          const menu = this.createSolveMenu(solveData, item);
          // Close any other open menus
          document.querySelectorAll('.solve-menu').forEach(m => m !== menu && m.remove());

          // Position the menu
          const rect = menuBtn.getBoundingClientRect();
          menu.style.top = rect.bottom + 'px';
          menu.style.left = rect.left + 'px';
          menu.style.display = 'block';

          // Close menu when clicking outside
          const closeMenu = (e) => {
            if (!menu.contains(e.target) && e.target !== menuBtn) {
              menu.remove();
              document.removeEventListener('click', closeMenu);
            }
          };
          document.addEventListener('click', closeMenu);
        });

        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'delete-btn';
        deleteBtn.textContent = '×';
        deleteBtn.addEventListener('click', () => {
          const index = this.state.history.indexOf(solveData);
          if (index > -1) {
            this.state.history.splice(index, 1);
            item.remove();
            this.updateStats();
            this.saveSettings();
          }
        });

        item.appendChild(numberSpan);
        item.appendChild(timeSpan);
        item.appendChild(dateSpan);
        item.appendChild(menuBtn);
        item.appendChild(deleteBtn);
        this.elements.historyList.prepend(item);
      }, updateStats() {
        document.getElementById('ao5').textContent = this.getAverage(5);
        document.getElementById('ao12').textContent = this.getAverage(12);
        if (this.state.history.length > 0) {
          const times = this.state.history.map(solve => solve.time);
          const bestTime = Math.min(...times);
          const worstTime = Math.max(...times);
          document.getElementById('best-time').textContent = bestTime.toFixed(3);
          document.getElementById('worst-time').textContent = worstTime.toFixed(3);

          // Update highlighting for all history items
          this.elements.historyList.querySelectorAll('.history-item').forEach(item => {
            item.classList.remove('best-solve', 'worst-solve');
            const timeEl = item.querySelector('.solve-time');
            const time = parseFloat(timeEl.textContent);
            if (time === bestTime) item.classList.add('best-solve');
            if (time === worstTime) item.classList.add('worst-solve');
          });
        } else {
          document.getElementById('best-time').textContent = '-';
          document.getElementById('worst-time').textContent = '-';
        }
      }, getAverage(n) {
        if (this.state.history.length < n) return '-';
        const solves = this.state.history.slice(0, n);

        // If too many DNFs, return DNF
        const dnfCount = solves.filter(solve => solve.isDNF).length;
        if (dnfCount > Math.ceil(n * 0.2)) return 'DNF';

        const times = solves.map(solve => solve.isDNF ? Infinity : solve.time);
        const min = Math.min(...times);
        const max = Math.max(...times);

        // For Ao5 and larger, remove best and worst times
        let sum = 0;
        let count = 0;
        if (n >= 5) {
          times.forEach(time => {
            if (time !== min && time !== max) {
              sum += time;
              count++;
            }
          });
        } else {
          sum = times.reduce((a, b) => a + b, 0);
          count = n;
        }

        return (sum / count).toFixed(3);
      },

      updateNumbering() {
        const show = this.elements.showNumbering.checked;
        this.elements.historyList.querySelectorAll('.solve-number').forEach(el => {
          el.style.display = show ? 'block' : 'none';
        });
      }, saveSettings() {
        try {
          const data = {
            darkMode: this.elements.darkMode.checked,
            showNumbering: this.elements.showNumbering.checked,
            autoScramble: this.elements.autoScramble.checked,
            wcaInspection: this.elements.wcaInspection.checked,
            currentEvent: this.elements.eventSelect.value,
            solveCounter: this.state.solveCounter,
            solveHistory: this.state.history.map(solve => ({
              time: solve.time,
              number: solve.number,
              date: solve.date.toISOString(),
              event: solve.event,
              isDNF: solve.isDNF || false,
              isPlus2: solve.isPlus2 || false,
              comment: solve.comment || ''
            }))
          };
          localStorage.setItem('cubeTimerData', JSON.stringify(data));
        } catch (error) {
          console.error('Error saving settings:', error);
        }
      },

      loadSettings() {
        try {
          const saved = localStorage.getItem('cubeTimerData');
          if (saved) {
            const data = JSON.parse(saved);

            this.elements.darkMode.checked = data.darkMode === true;
            document.body.classList.toggle('dark-theme', data.darkMode === true);

            this.elements.showNumbering.checked = data.showNumbering !== false;
            this.elements.autoScramble.checked = data.autoScramble !== false;
            this.elements.wcaInspection.checked = data.wcaInspection === true;

            if (data.currentEvent) {
              this.elements.eventSelect.value = data.currentEvent;
            }
            if (Array.isArray(data.solveHistory)) {
              this.state.solveCounter = data.solveCounter || 0; this.state.history = data.solveHistory.map(solve => ({
                time: solve.time,
                number: solve.number,
                date: new Date(solve.date),
                event: solve.event || '3x3',
                isDNF: solve.isDNF || false,
                isPlus2: solve.isPlus2 || false,
                comment: solve.comment || ''
              }));

              this.elements.historyList.innerHTML = '';
              this.state.history.forEach(solveData => this.addHistoryItemToDOM(solveData));
              this.updateStats();
            }
          }
        } catch (error) {
          console.error('Error loading settings:', error);
          localStorage.removeItem('cubeTimerData');
        }
      }, setInitialTheme() {
        document.querySelector('header').style.backgroundColor = '#121212';
        document.querySelectorAll('button').forEach(btn => {
          if (!btn.classList.contains('delete-btn') && !btn.classList.contains('clear-btn')) {
            btn.style.backgroundColor = '#121212';
            btn.style.color = '#fff';
            btn.style.borderColor = '#121212';
          }
        });
        document.querySelectorAll('.slider').forEach(slider => {
          slider.style.backgroundColor = '#121212';
        });
      },

      createSolveMenu(solveData, itemElement) {
        const menu = document.createElement('div');
        menu.className = 'solve-menu';
        document.body.appendChild(menu);

        const createMenuItem = (text, onClick) => {
          const item = document.createElement('div');
          item.className = 'solve-menu-item';
          item.textContent = text;
          item.addEventListener('click', onClick);
          menu.appendChild(item);
        };

        createMenuItem(solveData.isDNF ? 'Remove DNF' : 'DNF', () => {
          solveData.isDNF = !solveData.isDNF;
          const timeSpan = itemElement.querySelector('.solve-time');
          timeSpan.classList.toggle('dnf');
          this.saveSettings();
          this.updateStats();
          menu.remove();
        });

        createMenuItem(solveData.isPlus2 ? 'Remove +2' : '+2', () => {
          solveData.isPlus2 = !solveData.isPlus2;
          if (solveData.isPlus2) {
            solveData.time += 2;
          } else {
            solveData.time -= 2;
          }
          const timeSpan = itemElement.querySelector('.solve-time');
          timeSpan.textContent = solveData.time.toFixed(3);
          timeSpan.classList.toggle('plus2');
          this.saveSettings();
          this.updateStats();
          menu.remove();
        });

        createMenuItem(solveData.comment ? 'Edit Comment' : 'Add Comment', () => {
          const comment = prompt('Enter comment:', solveData.comment || '');
          if (comment !== null) {
            solveData.comment = comment.trim();
            let commentDiv = itemElement.querySelector('.solve-comment');
            if (solveData.comment) {
              if (!commentDiv) {
                commentDiv = document.createElement('div');
                commentDiv.className = 'solve-comment';
                itemElement.querySelector('.solve-date').appendChild(commentDiv);
              }
              commentDiv.textContent = solveData.comment;
            } else if (commentDiv) {
              commentDiv.remove();
            }
            this.saveSettings();
          }
          menu.remove();
        });

        return menu;
      }
    };


    // Initialize timer when page loads
    document.addEventListener('DOMContentLoaded', () => Timer.init());
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(reg => console.log('SW registered:', reg))
          .catch(err => console.error('SW failed:', err));
      });
    }

  </script>
<script>
  const screenshotBtn = document.getElementById("screenshot-btn");

  screenshotBtn.addEventListener("click", () => {
    alert("It will only take the screenshot of the visible part of the page, not the full page. If you want to take a full page screenshot, use the browser's built-in screenshot feature.");
    screenshotBtn.style.visibility = "hidden"; // hide button

    const target = document.getElementById("screenshot-target");

    setTimeout(() => {
      html2canvas(target, {
        useCORS: true,
        backgroundColor: getComputedStyle(document.body).backgroundColor,
        scrollY: -window.scrollY,
        scrollX: -window.scrollX,
        windowWidth: document.documentElement.scrollWidth,
        windowHeight: document.documentElement.scrollHeight
      }).then(canvas => {
        const link = document.createElement("a");
        link.download = "full-page-screenshot.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
        screenshotBtn.style.visibility = "visible"; // restore button
      }).catch(err => {
        console.error("Screenshot failed:", err);
        alert("Screenshot failed. See console.");
        screenshotBtn.style.visibility = "visible";
      });
    }, 100);
  });
</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-07XR82S9KC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-07XR82S9KC');
</script>

</body>

</html>

</html>
